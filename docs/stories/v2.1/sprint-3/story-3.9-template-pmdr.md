# STORY 3.9: Template PMDR

**ID:** 3.9 | **Epic:** [EPIC-S3](../../../epics/epic-s3-quality-templates.md)
**Sprint:** 3 | **Points:** 3 | **Priority:** üü° Medium | **Created:** 2025-01-19
**Updated:** 2025-12-03
**Status:** üìã Draft

**Reference:** [Decis√£o 9 - Template Engine](../../../audits/PEDRO-DECISION-LOG.md#decis√£o-9)

**Predecessor:** Story 3.6 (Template Engine Core) ‚è≥

---

## User Story

**Como** PM (Morgan),
**Quero** template PMDR (Product Management Decision Record) em formato Handlebars,
**Para que** possa documentar decis√µes de produto de forma padronizada e rastre√°vel.

---

## Acceptance Criteria

### Template Structure
- [ ] AC3.9.1: Template segue padr√£o similar ao ADR (Context, Decision, Impact)
- [ ] AC3.9.2: Inclui se√ß√£o de Business Impact espec√≠fica para produto
- [ ] AC3.9.3: Suporta stakeholders e approval workflow
- [ ] AC3.9.4: Inclui m√©tricas de sucesso para a decis√£o

### Validation
- [ ] AC3.9.5: JSON Schema valida output gerado
- [ ] AC3.9.6: Valida que business impact n√£o est√° vazio

### Integration
- [ ] AC3.9.7: Template registrado no TemplateEngine
- [ ] AC3.9.8: Gera√ß√£o via CLI: `aios generate pmdr`

---

## Scope

### Template Location
`.aios-core/product/templates/pmdr.hbs`

### Template Structure

```handlebars
---
template_id: pmdr
template_name: Product Management Decision Record
version: 1.0
variables:
  - name: number
    type: number
    required: true
    auto: next_pmdr_number
  - name: title
    type: string
    required: true
    prompt: "T√≠tulo da decis√£o de produto:"
  - name: status
    type: choice
    required: true
    choices: [Draft, Under Review, Approved, Rejected, Superseded]
    default: Draft
  - name: owner
    type: string
    required: true
    prompt: "Quem √© o owner dessa decis√£o?"
  - name: stakeholders
    type: array
    required: true
    prompt: "Quem s√£o os stakeholders?"
  - name: context
    type: text
    required: true
    prompt: "Qual √© o contexto de produto/neg√≥cio?"
  - name: decision
    type: text
    required: true
    prompt: "Qual √© a decis√£o de produto tomada?"
  - name: businessImpact
    type: text
    required: true
    prompt: "Qual √© o impacto no neg√≥cio?"
  - name: successMetrics
    type: array
    required: true
---

# PMDR {{padNumber number 3}}: {{title}}

**Status:** {{status}}
**Date:** {{formatDate now "YYYY-MM-DD"}}
**Owner:** {{owner}}

---

## Stakeholders

{{#each stakeholders}}
- {{this}}
{{/each}}

---

## Context

### Business Context
{{context}}

### Current State
{{currentState}}

### Problem Statement
{{problemStatement}}

---

## Decision

{{decision}}

### Rationale
{{rationale}}

---

## Business Impact

### Expected Impact
{{businessImpact}}

### Revenue/Cost Implications
{{#if revenueImplications}}
- **Revenue:** {{revenueImplications}}
{{/if}}
{{#if costImplications}}
- **Cost:** {{costImplications}}
{{/if}}

### Customer Impact
{{customerImpact}}

---

## Success Metrics

| Metric | Current | Target | Timeline |
|--------|---------|--------|----------|
{{#each successMetrics}}
| {{this.metric}} | {{this.current}} | {{this.target}} | {{this.timeline}} |
{{/each}}

---

## Implementation

### Phases
{{#each implementationPhases}}
1. **{{this.name}}** ({{this.duration}}): {{this.description}}
{{/each}}

### Dependencies
{{#each dependencies}}
- {{this}}
{{/each}}

### Risks
| Risk | Impact | Mitigation |
|------|--------|------------|
{{#each risks}}
| {{this.risk}} | {{this.impact}} | {{this.mitigation}} |
{{/each}}

---

## Alternatives Considered

{{#if alternatives}}
{{#each alternatives}}
### Option {{add @index 1}}: {{this.name}}

{{this.description}}

**Why Not Chosen:** {{this.whyNot}}
{{/each}}
{{else}}
_No alternatives documented._
{{/if}}

---

## Approval

{{#if approvals}}
| Stakeholder | Decision | Date | Notes |
|-------------|----------|------|-------|
{{#each approvals}}
| {{this.stakeholder}} | {{this.decision}} | {{this.date}} | {{this.notes}} |
{{/each}}
{{else}}
_Pending approval._
{{/if}}

---

## Related Decisions

{{#if relatedPMDRs}}
{{#each relatedPMDRs}}
- [PMDR {{this.number}}](./pmdr-{{padNumber this.number 3}}.md): {{this.title}}
{{/each}}
{{else}}
_No related decisions._
{{/if}}

---

**Generated by:** AIOS Template Engine v2.0
**Template Version:** pmdr-1.0
```

### JSON Schema

`.aios-core/product/templates/engine/schemas/pmdr.schema.json`:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PMDR Template Variables",
  "type": "object",
  "required": ["number", "title", "status", "owner", "stakeholders", "context", "decision", "businessImpact", "successMetrics"],
  "properties": {
    "number": { "type": "integer", "minimum": 1 },
    "title": { "type": "string", "minLength": 5, "maxLength": 150 },
    "status": {
      "type": "string",
      "enum": ["Draft", "Under Review", "Approved", "Rejected", "Superseded"]
    },
    "owner": { "type": "string", "minLength": 1 },
    "stakeholders": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string" }
    },
    "context": { "type": "string", "minLength": 20 },
    "decision": { "type": "string", "minLength": 20 },
    "businessImpact": { "type": "string", "minLength": 20 },
    "successMetrics": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["metric", "target"],
        "properties": {
          "metric": { "type": "string" },
          "current": { "type": "string" },
          "target": { "type": "string" },
          "timeline": { "type": "string" }
        }
      }
    }
  }
}
```

---

## Tasks

### Design (2h)
- [ ] 3.9.1: Design PMDR structure (similar to ADR)
  - [ ] 3.9.1.1: Identify product-specific sections
  - [ ] 3.9.1.2: Define approval workflow fields
  - [ ] 3.9.1.3: Define success metrics structure

### Implementation (2h)
- [ ] 3.9.2: Create Handlebars template
  - [ ] 3.9.2.1: Base structure with business sections
  - [ ] 3.9.2.2: Approval tracking table
  - [ ] 3.9.2.3: Success metrics table

### Testing (2h)
- [ ] 3.9.3: Test PMDR generation
  - [ ] 3.9.3.1: Generate sample PMDR
  - [ ] 3.9.3.2: Test approval workflow fields
  - [ ] 3.9.3.3: Validate schema

**Total Estimated:** 6h (~1 day)

---

## Dev Notes

### Difference from ADR
- **ADR:** Technical/architecture decisions
- **PMDR:** Product/business decisions

Key differences:
- Business impact section (mandatory)
- Success metrics with targets
- Approval workflow tracking
- Revenue/cost implications

### Testing

| Test ID | Name | Priority |
|---------|------|----------|
| PMDR-01 | Generate PMDR with required fields | P0 |
| PMDR-02 | Success metrics table renders | P0 |
| PMDR-03 | Approval workflow renders | P1 |
| PMDR-04 | Validation fails without businessImpact | P0 |

---

## ü§ñ CodeRabbit Integration

### Story Type Analysis

**Primary Type:** Tooling/Templates
**Secondary Type(s):** Documentation
**Complexity:** Low (template creation)

### Specialized Agent Assignment

**Primary Agents:**
- @dev: Template implementation

**Supporting Agents:**
- @pm: PMDR format review

### Quality Gate Tasks

- [ ] Pre-Commit (@dev): Run PMDR-01 to PMDR-04 tests
- [ ] Pre-PR (@github-devops): Validate template syntax

### Self-Healing Configuration

**Expected Self-Healing:**
- Primary Agent: @dev (light mode)
- Max Iterations: 2
- Timeout: 10 minutes
- Severity Filter: CRITICAL only

**Predicted Behavior:**
- CRITICAL issues: Auto-fix
- HIGH issues: Document only

### Focus Areas

**Primary Focus:**
- Business impact validation
- Success metrics structure

**Secondary Focus:**
- Approval workflow correctness

---

## Dependencies

**Depends on:**
- Story 3.6 (Template Engine Core) ‚è≥

**Blocks:**
- Story 3.12 (Documentation Sprint 3)

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Template generates valid PMDR
- [ ] PMDR-01 to PMDR-04 tests pass
- [ ] QA Review passed
- [ ] PR created and approved

---

## Dev Agent Record

_To be populated during implementation_

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-19 | 1.0 | Story created (in bundled file) | River |
| 2025-12-03 | 2.0 | Separated into individual story file | Pax (@po) |

---

## QA Results

_To be populated after implementation_

---

**Created by:** River üåä
**Validated by:** Pax üéØ (PO)
